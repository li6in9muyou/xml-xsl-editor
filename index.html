<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>âœ’ï¸XMLã€XSLç¼–è¾‘å™¨</title>
    <style>
      .editor {
        height: 500px;
        min-width: 500px;
        max-width: 500px;
      }
      .editors {
        display: flex;
        gap: 1rem;
      }
      section > header {
        display: flex;
        gap: 10px;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <h1>XMLã€XSLç¼–è¾‘å™¨âœ’ï¸</h1>
    <h2>
      ä»“åº“åœ°å€
      <a href="https://github.com/li6in9muyou/xml-xsl-editor">
        li6in9muyou/xml-xsl-editor </a
      >ï¼Œè¯·å¸®åŠ©æˆ‘å®Œå–„æœ¬åº”ç”¨ ğŸ™ã€‚
    </h2>
    <section>
      <button data-save>ğŸ’¾ä¿å­˜(ctrl + s)</button>
      <button data-reset-data>âš ï¸é‡ç½®æ•°æ®</button>
    </section>
    <main class="editors">
      <section>
        <header>
          <h3>XMLæ•°æ®</h3>
          <button data-format-xml>æ•´ç†æ ¼å¼</button>
        </header>
        <div id="xml" class="editor"></div>
      </section>
      <section>
        <header>
          <h3>XSLæ¨¡ç‰ˆ</h3>
          <button data-format-xsl>æ•´ç†æ ¼å¼</button>
        </header>
        <div id="xsl" class="editor"></div>
      </section>
    </main>
    <h3>è¾“å‡ºçš„HTMLé¢„è§ˆğŸ‘€ï¼ˆè¯•è¯•ä¿®æ”¹ä¸Šé¢çš„ä»£ç ï¼Œå®æ—¶æ›´æ–°ï¼ï¼‰</h3>
    <div id="preview"></div>
    <script>
      const oneXML = `<?xml version="1.0" encoding="gb2312" standalone="no"?>
<!DOCTYPE å­¦ç”Ÿ SYSTEM "student.dtd">
<?xml-stylesheet type="text/xsl" href="student.xsl"?>
<å­¦ç”Ÿ>
<ä¸ªäººåŸºæœ¬ä¿¡æ¯>
<ç…§ç‰‡>miffy.jpg</ç…§ç‰‡>
<å§“å>ç±³è²</å§“å>
<æ€§åˆ«>å¥³</æ€§åˆ«>
<æ°‘æ—>å…”ä½³æ—</æ°‘æ—>
<å‡ºç”Ÿåœ°>å¤§è·å…°</å‡ºç”Ÿåœ°>
<é€šè®¯åœ°å€>
 <æ¡ç›®>130012</æ¡ç›®>
 <æ¡ç›®>å‰æ—çœé•¿æ˜¥å¸‚å‰è¿›å¤§è¡— 2699 å·</æ¡ç›®>
 <æ¡ç›®>å‰æ—å¤§å­¦è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯å­¦é™¢</æ¡ç›®>
</é€šè®¯åœ°å€>
<ç”µå­é‚®ä»¶>miffy@yahoo.com</ç”µå­é‚®ä»¶>
</ä¸ªäººåŸºæœ¬ä¿¡æ¯>
<å­¦å†å’Œå·¥ä½œç®€å†>
<æ¡ç›®>2003 å¹´æ¯•ä¸šäºå‰æ—å¤§å­¦é™„å±å°å­¦</æ¡ç›®>
<æ¡ç›®>2006 å¹´æ¯•ä¸šäºå‰æ—å¤§å­¦é™„å±ä¸­å­¦åˆä¸­éƒ¨</æ¡ç›®>
<æ¡ç›®>2009 å¹´æ¯•ä¸šäºå‰æ—å¤§å­¦é™„å±ä¸­å­¦é«˜ä¸­éƒ¨</æ¡ç›®>
<æ¡ç›®>2013 å¹´æ¯•ä¸šäºå‰æ—å¤§å­¦è®¡ç®—æœºå­¦é™¢</æ¡ç›®>
<æ¡ç›®>2012.07 è‡³ 2012.09 åœ¨å‰æ—å¤§å­¦å°±ä¸šæŒ‡å¯¼ä¸­å¿ƒå®ä¹ </æ¡ç›®>
</å­¦å†å’Œå·¥ä½œç®€å†>
<å·²ä¿®è¯¾ç¨‹>
<æ¡ç›®>æ•°æ®ç»“æ„</æ¡ç›®>
<æ¡ç›®>æ•°æ®åº“åŸç†</æ¡ç›®>
<æ¡ç›®>C è¯­è¨€ç¨‹åºè®¾è®¡</æ¡ç›®>
<æ¡ç›®>Java è¯­è¨€ç¨‹åºè®¾è®¡</æ¡ç›®>
<æ¡ç›®>Web åº”ç”¨å¼€å‘åŸºç¡€</æ¡ç›®>
<æ¡ç›®>XML è¯­è¨€</æ¡ç›®>
</å·²ä¿®è¯¾ç¨‹>
<å·²è·å¥–åŠ±>
<æ¡ç›®>2012 è·ä¸­å›½å¤§å­¦ç”Ÿåˆ›æ–°é¡¹ç›®ä¸€ç­‰å¥–</æ¡ç›®>
<æ¡ç›®>2013 è·ä¸­å›½å¤§å­¦ç”Ÿè½¯ä»¶ç«èµ›ä¸€ç­‰å¥–</æ¡ç›®>
</å·²è·å¥–åŠ±>
<å·²å‘è¡¨è®ºæ–‡>
<æ¡ç›®>äººæœºå¯¹è¯ä¸­å…³é”®æŠ€æœ¯çš„æ¢ç´¢ï¼Œ2011 å¹´å‘è¡¨äºã€Šæœºå™¨ä¸äººã€‹åˆ›åˆŠå·ç¬¬ 1 é¡µ</æ¡ç›®>
<æ¡ç›®>ç±³è²å®¶æ—ç¥–å…ˆè¿½è¸ªï¼Œ2012 å¹´å‘è¡¨äºã€Šç‰©ç§èµ·æºã€‹å· 99999 ç¬¬ 8888 é¡µ</æ¡ç›®>
</å·²å‘è¡¨è®ºæ–‡>
</å­¦ç”Ÿ>
`;
      const oneXSL = `<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:template match="/">
    <html>
      <body>
        <h2>
          <xsl:value-of select="å­¦ç”Ÿ/ä¸ªäººåŸºæœ¬ä¿¡æ¯/å§“å"></xsl:value-of>
          <span>çš„ç®€å†</span>
        </h2>
        <img id="selfie">
          <xsl:attribute name="src">
            <xsl:value-of select="å­¦ç”Ÿ/ä¸ªäººåŸºæœ¬ä¿¡æ¯/ç…§ç‰‡"/>
          </xsl:attribute>
        </img>
      </body>
    </html>
  </xsl:template>
</xsl:stylesheet>
`;
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/ace-builds@1.13.0/src-noconflict/ace.min.js"
      type="text/javascript"
      charset="utf-8"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/xml-beautify@1.2.3/dist/XmlBeautify.js"></script>
    <script>
      ace.config.set(
        "basePath",
        "https://cdn.jsdelivr.net/npm/ace-builds@1.13.0/src-noconflict"
      );
      const B = new XmlBeautify();
      const STORAGE_PREFIX = "xml-xsl-editor";

      function renderPreview(xmlText, xslText, previewSelector) {
        const p = new DOMParser();
        const xml = p.parseFromString(xmlText, "application/xml");
        const xsl = p.parseFromString(xslText, "application/xml");
        const trans = new XSLTProcessor();
        trans.importStylesheet(xsl);
        const nodes = trans.transformToFragment(xml, document);
        document.querySelector(previewSelector).replaceChildren(nodes);
      }

      function saveToLocalStorage() {
        localStorage.setItem(`${STORAGE_PREFIX}-xml`, xmlEdit.getValue());
        localStorage.setItem(`${STORAGE_PREFIX}-xsl`, xslEdit.getValue());
      }

      function isEmpty(v) {
        return v === null || v === undefined || v === "";
      }

      function loadFromLocalStorage() {
        const savedXML = localStorage.getItem(`${STORAGE_PREFIX}-xml`);
        if (!isEmpty(savedXML)) {
          xmlEdit.setValue(savedXML);
        }

        const savedXSL = localStorage.getItem(`${STORAGE_PREFIX}-xsl`);
        if (!isEmpty(savedXML)) {
          xslEdit.setValue(savedXSL);
        }
      }

      function clearLocalStorage() {
        localStorage.removeItem(`${STORAGE_PREFIX}-xml`);
        localStorage.removeItem(`${STORAGE_PREFIX}-xsl`);
        xmlEdit.setValue(oneXML);
        formatXMLXSL(xmlEdit);
        xslEdit.setValue(oneXSL);
        formatXMLXSL(xslEdit);
      }

      function genEditor(text, id) {
        const e = ace.edit(id);
        e.setTheme("ace/theme/monokai");
        e.session.setMode("ace/mode/xml");
        e.session.setValue(B.beautify(text));
        e.commands.addCommand({
          name: "saveFile",
          bindKey: {
            win: "Ctrl-S",
            mac: "Command-S",
            sender: "editor|cli",
          },
          exec: saveToLocalStorage,
        });
        return e;
      }

      function formatXMLXSL(edit) {
        edit.session.setValue(B.beautify(edit.session.getValue()));
      }
    </script>
    <script>
      const xmlEdit = genEditor(oneXML, "xml");
      const xslEdit = genEditor(oneXSL, "xsl");
      loadFromLocalStorage();
      const updatePreview = () =>
        renderPreview(xmlEdit.getValue(), xslEdit.getValue(), "#preview");
      updatePreview();
      xmlEdit.session.on("change", updatePreview);
      xslEdit.session.on("change", updatePreview);
      document
        .querySelector("[data-format-xsl]")
        .addEventListener("click", () => formatXMLXSL(xslEdit));
      document
        .querySelector("[data-format-xml]")
        .addEventListener("click", () => () => formatXMLXSL(xmlEdit));
    </script>
    <script>
      document
        .querySelector("[data-save]")
        .addEventListener("click", saveToLocalStorage);
      document
        .querySelector("[data-reset-data]")
        .addEventListener("click", () => {
          clearLocalStorage();
          loadFromLocalStorage();
        });
    </script>
  </body>
</html>
