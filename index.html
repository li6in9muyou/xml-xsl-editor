<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>XML、XSL编辑器</title>
    <style>
      .editor {
        height: 500px;
        min-width: 500px;
        max-width: 500px;
      }
      .editors {
        display: flex;
        gap: 1rem;
      }
      .warn {
        background-color: lightpink;
        padding: 8px;
        width: fit-content;
      }
    </style>
  </head>
  <body>
    <h1>XML、XSL编辑器</h1>
    <h2 class="warn">刷新或关闭标签页你做的修改会全部丢失！</h2>
    <main class="editors">
      <section>
        <h3>XML数据</h3>
        <div id="xml" class="editor"></div>
      </section>
      <section>
        <h3>XSL模版</h3>
        <div id="xsl" class="editor"></div>
      </section>
    </main>
    <h3>输出的HTML预览（试试修改上面的代码，实时更新！）</h3>
    <div id="preview"></div>
    <script>
      const oneXML = `<?xml version="1.0" encoding="gb2312" standalone="no"?>
<!DOCTYPE 学生 SYSTEM "student.dtd">
<?xml-stylesheet type="text/xsl" href="student.xsl"?>
<学生>
<个人基本信息>
<照片>miffy.jpg</照片>
<姓名>米菲</姓名>
<性别>女</性别>
<民族>兔佳族</民族>
<出生地>大荷兰</出生地>
<通讯地址>
 <条目>130012</条目>
 <条目>吉林省长春市前进大街 2699 号</条目>
 <条目>吉林大学计算机科学与技术学院</条目>
</通讯地址>
<电子邮件>miffy@yahoo.com</电子邮件>
</个人基本信息>
<学历和工作简历>
<条目>2003 年毕业于吉林大学附属小学</条目>
<条目>2006 年毕业于吉林大学附属中学初中部</条目>
<条目>2009 年毕业于吉林大学附属中学高中部</条目>
<条目>2013 年毕业于吉林大学计算机学院</条目>
<条目>2012.07 至 2012.09 在吉林大学就业指导中心实习</条目>
</学历和工作简历>
<已修课程>
<条目>数据结构</条目>
<条目>数据库原理</条目>
<条目>C 语言程序设计</条目>
<条目>Java 语言程序设计</条目>
<条目>Web 应用开发基础</条目>
<条目>XML 语言</条目>
</已修课程>
<已获奖励>
<条目>2012 获中国大学生创新项目一等奖</条目>
<条目>2013 获中国大学生软件竞赛一等奖</条目>
</已获奖励>
<已发表论文>
<条目>人机对话中关键技术的探索，2011 年发表于《机器与人》创刊号第 1 页</条目>
<条目>米菲家族祖先追踪，2012 年发表于《物种起源》卷 99999 第 8888 页</条目>
</已发表论文>
</学生>
`;
      const oneXSL = `<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
  <xsl:template match="/">
    <html>
      <body>
        <h2>
          <xsl:value-of select="学生/个人基本信息/姓名"></xsl:value-of>
          <span>的简历</span>
        </h2>
      </body>
    </html>
  </xsl:template>
</xsl:stylesheet>
`;
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/ace-builds@1.13.0/src-noconflict/ace.min.js"
      type="text/javascript"
      charset="utf-8"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/xml-beautify@1.2.3/dist/XmlBeautify.js"></script>
    <script>
      function renderPreview(xmlText, xslText, previewSelector) {
        const p = new DOMParser();
        const xml = p.parseFromString(xmlText, "application/xml");
        const xsl = p.parseFromString(xslText, "application/xml");
        const trans = new XSLTProcessor();
        trans.importStylesheet(xsl);
        const nodes = trans.transformToFragment(xml, document);
        document.querySelector(previewSelector).replaceChildren(nodes);
      }
    </script>
    <script>
      ace.config.set(
        "basePath",
        "https://cdn.jsdelivr.net/npm/ace-builds@1.13.0/src-noconflict"
      );
      const B = new XmlBeautify();
      (() => {
        function genEditor(text, id) {
          const e = ace.edit(id);
          e.setTheme("ace/theme/monokai");
          e.session.setMode("ace/mode/xml");
          e.session.setValue(B.beautify(text));
          return e;
        }

        function genXmlXslPreview(xmlEdit, xslEdit, previewSelector) {
          const cb = () =>
            renderPreview(
              xmlEdit.getValue(),
              xslEdit.getValue(),
              previewSelector
            );
          cb();
          xmlEdit.session.on("change", cb);
          xslEdit.session.on("change", cb);
        }

        genXmlXslPreview(
          genEditor(oneXML, "xml"),
          genEditor(oneXSL, "xsl"),
          "#preview"
        );
      })();
    </script>
  </body>
</html>
